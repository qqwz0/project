{% load static %}

{% if user_profile.role == "–°—Ç—É–¥–µ–Ω—Ç" %}
    {% if sent_requests %}
        <h2>üì© –ù–∞–¥—ñ—Å–ª–∞–Ω—ñ –∑–∞–ø–∏—Ç–∏</h2>
        {% for request in sent_requests %}
            <div class="request-card">
                <div class="request-user">
                    {% if user.profile.profile_picture %}
                        <img src="{{ request.teacher_id.teacher_id.profile_picture }}" alt="–§–æ—Ç–æ –ø—Ä–æ—Ñ—ñ–ª—é" class="default-avatar">
                    {% else %}
                        <img src="{% static 'images/default-avatar.jpg' %}" alt="–§–æ—Ç–æ –ø—Ä–æ—Ñ—ñ–ª—é" class="request-avatar">
                    {% endif %}
                    <div class="user-info">
                        <h3>{{ request.teacher_id.teacher_id.get_full_name }}</h3>
                        <p class="role">{{ request.teacher_id.teacher_id.role }}</p>
                        {% if request.proposed_theme_id %}
                            <p class="theme">{{ request.proposed_theme_id.theme }}</p>
                        {% endif %}
                    </div>
                </div>
                <span class="status {{ request.request_status }}">{{ request.get_request_status_display }}</span>
            </div>
        {% endfor %}
    {% else %}
        <p>–í–∏ —â–µ –Ω–µ –Ω–∞–¥—Å–∏–ª–∞–ª–∏ –∑–∞–ø–∏—Ç—ñ–≤.</p>
    {% endif %}

    {% elif user_profile.role == "–í–∏–∫–ª–∞–¥–∞—á" %}
    {% if received_requests %}
        <h2>üì• –û—Ç—Ä–∏–º–∞–Ω—ñ –∑–∞–ø–∏—Ç–∏</h2>
        {% for request in received_requests %}
            <div class="request-card">
                <div class="request-user">
                    {% if request.student_id.profile_picture %}
                        <img src="{{ request.student_id.profile_picture.url }}" alt="–§–æ—Ç–æ –ø—Ä–æ—Ñ—ñ–ª—é" class="request-avatar">
                    {% else %}
                        <img src="{% static 'images/default-avatar.jpg' %}" alt="–§–æ—Ç–æ –ø—Ä–æ—Ñ—ñ–ª—é" class="request-avatar">
                    {% endif %}
                    <div class="user-info">
                        <h3>{{ request.student_id.get_full_name }}</h3>
                        <p class="role">–ì—Ä—É–ø–∞: {{ request.student_id.academic_group }}</p>
                        {% if request.proposed_theme_id %}
                            <p class="theme">{{ request.proposed_theme_id.theme }}</p>
                        {% endif %}
                        <p class="motivation">–ú–æ—Ç–∏–≤–∞—Ü—ñ—è: {{ request.motivation_text }}</p>
                    </div>
                </div>
                
                <!-- Buttons for approval/decline -->
                <div class="request-actions">
                    {% comment %} <form method="post" action="{% url 'approve_request' request.id %}"> {% endcomment %}
                        {% comment %} {% csrf_token %} {% endcomment %}
                        <button type="submit" class="approve-btn">‚úÖ –ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏</button>
                    {% comment %} </form> {% endcomment %}
                    {% comment %} <form method="post" action="{% url 'decline_request' request.id %}"> {% endcomment %}
                        {% comment %} {% csrf_token %} {% endcomment %}
                        <button type="submit" class="decline-btn">‚ùå –í—ñ–¥—Ö–∏–ª–∏—Ç–∏</button>
                    {% comment %} </form> {% endcomment %}
                </div>
            </div>
        {% endfor %}
    {% else %}
        <p>–£ –≤–∞—Å –Ω–µ–º–∞—î –Ω–æ–≤–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤.</p>
    {% endif %}
{% endif %}



{% block scripts %}
<script>
    function loadTab(tabName) {
        document.querySelectorAll('.tab-content').forEach(el => el.style.display = 'none');
        document.getElementById(tabName + '-section').style.display = 'block';

        document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
        event.target.classList.add('active');
    }
</script>
{% endblock %}
