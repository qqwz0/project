{% load catalog_extras %}
{% load static %}

<div id="profile-content">
    <!-- –î–æ–¥–∞—î–º–æ –ø—Ä–∞–≤–∏–ª—å–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    
{% block content %}
    {% if user.role == "–°—Ç—É–¥–µ–Ω—Ç" %}
    {% if active_requests %}
            <h2>üìù –ê–∫—Ç–∏–≤–Ω—ñ —Ä–æ–±–æ—Ç–∏</h2>
            {% for request_obj in active_requests %}
            <div class="request-card">
                <div class="request-user">
                        {% if request_obj.teacher_id.teacher_id.profile_picture %}
                            <img src="{{ request_obj.teacher_id.teacher_id.profile_picture.url }}" alt="–§–æ—Ç–æ –ø—Ä–æ—Ñ—ñ–ª—é" class="request-avatar">
                    {% else %}
                        <img src="{% static 'images/default-avatar.jpg' %}" alt="–§–æ—Ç–æ –ø—Ä–æ—Ñ—ñ–ª—é" class="request-avatar">
                    {% endif %}
                    <div class="user-info">
                            <a href="{% url 'profile_detail' request_obj.teacher_id.teacher_id.id %}" class="profile-link">
                                {{ request_obj.teacher_id.teacher_id.get_full_name }}
                        </a>
                            <p class="role">{{ request_obj.teacher_id.teacher_id.role }}</p>
                            {% if request_obj.teacher_theme %}
                            <strong>–¢–µ–º–∞:</strong>
                                <p class="theme">{{ request_obj.teacher_theme.theme }}</p>
                        {% endif %}
                            {% if request_obj.student_themes.all %}
                            <strong>–¢–µ–º–∞—Ç–∏–∫–∞ —Å—Ç—É–¥–µ–Ω—Ç–∞:</strong>
                            <ul style="list-style-type: none">
                                    {% for theme in request_obj.student_themes.all %}
                                    <li>{{ theme.theme }}</li>
                                {% endfor %}
                            </ul>
                        {% endif %}
                        <strong>–ú–æ—Ç–∏–≤–∞—Ü—ñ—è:</strong>
                            <p class="motivation">{{ request_obj.motivation_text }}</p>
                    </div>
                </div>

                <!-- –°–µ–∫—Ü—ñ—è —Ñ–∞–π–ª—ñ–≤ -->
                <div class="files-section mt-4">
                        <h4 class="d-flex align-items-center">
                            <span class="paperclip-icon">üìé</span> –§–∞–π–ª–∏
                        </h4>
                        {% with files=active_request_files|get_item:request_obj.id %}
                            <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ñ–∞–π–ª—ñ–≤ –∑ –ø—Ä–æ–∫—Ä—É—Ç–∫–æ—é -->
                            <div id="files-container" style="background-color: #F2F4F7; border-radius: 10px; margin-bottom: 15px; max-height: 300px; overflow-y: auto; padding: 10px; scrollbar-width: thin; scrollbar-color: #C0C0C0 #F0F0F0;">
                                {% for file in files %}
                                    <div class="file-block" style="margin-bottom: 15px; background-color: white; border-radius: 6px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
                                        <div class="file-header" style="display: flex; justify-content: space-between; align-items: center; background-color: #E6F0FF; padding: 12px; border-radius: 6px 6px 0 0; margin-bottom: 0; position: relative;">
                                            <span style="flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">{{ file.get_filename }}</span>
                                            <div style="display: flex; gap: 10px;">
                                                <a href="{% url 'download_file' file.pk %}" class="download-button" style="color: #3B82F6; background-color: #EFF6FF; border-radius: 4px; padding: 4px 8px; display: flex; align-items: center; text-decoration: none;">
                                                    <i class="fas fa-download" style="margin-right: 4px;"></i>
                                                    <span>–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏</span>
                                                </a>
                                                {% if user == file.uploaded_by %}
                                                    <button class="delete-file" 
                                                            style="background-color: #FEE2E2; border: none; color: #EF4444; cursor: pointer; border-radius: 4px; padding: 4px 8px; display: flex; align-items: center;"
                                                            data-file-id="{{ file.pk }}"
                                                            data-url="{% url 'delete_file' file.pk %}">
                                                        <i class="fas fa-trash" style="margin-right: 4px;"></i>
                                                        <span>–í–∏–¥–∞–ª–∏—Ç–∏</span>
                                                    </button>
                                                {% endif %}
                                            </div>
                                        </div>
                                        
                                        <!-- –°–µ–∫—Ü—ñ—è –æ–ø–∏—Å—É —Ñ–∞–π–ª—É -->
                                        {% if file.description %}
                                        <div class="file-description" style="background-color: #E6F0FF; padding: 15px; border-radius: 0 0 6px 6px; margin-top: 1px;">
                                            <p style="margin: 0; font-size: 14px;">
                                                <strong>–û–ø–∏—Å:</strong><br>
                                                {{ file.description }}
                                            </p>
                                        </div>
                                        {% else %}
                                        <div style="height: 1px; background-color: #E6F0FF; border-radius: 0 0 6px 6px;"></div>
                                        {% endif %}

                                        <!-- –ü–æ–∫–∞–∑—É—î–º–æ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ –≤–∏–∫–ª–∞–¥–∞—á–∞ –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–∞ -->
                                        {% if file.comments.all %}
                                        <div class="teacher-comments" style="padding: 15px; background-color: white; border-radius: 0 0 6px 6px; border-top: 1px solid #E5E7EB;">
                                            <h6 style="margin-bottom: 10px; color: #2563EB;">–ö–æ–º–µ–Ω—Ç–∞—Ä—ñ –≤–∏–∫–ª–∞–¥–∞—á–∞:</h6>
                                            <!-- –°–ø–∏—Å–æ–∫ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤ -->
                                            <div class="comments-list">
                                                {% for comment in file.comments.all %}
                                                    <div class="comment" style="background-color: {% if comment.author.role == '–í–∏–∫–ª–∞–¥–∞—á' %}#E6F0FF{% else %}#F3F4F6{% endif %}; padding: 10px; border-radius: 6px; margin-bottom: 8px;">
                                                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                                            <span style="font-weight: 500; color: #2563EB;">{{ comment.author.get_full_name }}</span>
                                                            <span style="color: #6B7280; font-size: 12px;">{{ comment.created_at|date:"d.m.Y H:i" }}</span>
                                                        </div>
                                                        <p style="margin: 0; font-size: 14px;">{{ comment.text }}</p>
                                                        {% if comment.attachment %}
                                                        <div class="attachment" style="margin-top: 8px; padding: 8px; background-color: rgba(255,255,255,0.6); border-radius: 4px;">
                                                            <a href="{{ comment.attachment.url }}" download style="display: flex; align-items: center; color: #2563EB; text-decoration: none;">
                                                                <i class="fas fa-paperclip" style="margin-right: 5px;"></i>
                                                                <span style="font-size: 14px; overflow: hidden; text-overflow: ellipsis;">{{ comment.get_attachment_filename }}</span>
                                                            </a>
                                                        </div>
                                                        {% endif %}
                                                        {% if user == comment.author %}
                                                            <button class="delete-comment" 
                                                                    style="background: none; border: none; color: #EF4444; font-size: 12px; padding: 0; margin-top: 5px; cursor: pointer;"
                                                                    data-comment-id="{{ comment.id }}">
                                                                –í–∏–¥–∞–ª–∏—Ç–∏
                                                            </button>
                                                        {% endif %}
                                                    </div>
                                                {% endfor %}
                                            </div>
                                        </div>
                                        {% endif %}
                                    </div>
                                {% empty %}
                                    <p class="text-muted" style="text-align: center; padding: 10px;">–ù–µ–º–∞—î –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤</p>
                                {% endfor %}
                            </div>

                            <style>
                                /* –î–æ–¥–∞—î–º–æ —Å—Ç–∏–ª—å –¥–ª—è –∑–±—ñ–ª—å—à–µ–Ω–Ω—è —à–∏—Ä–∏–Ω–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
                                .container {
                                    max-width: 1400px !important; /* –ó–±—ñ–ª—å—à—É—î–º–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É —à–∏—Ä–∏–Ω—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
                                    width: 95% !important;        /* –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ —à–∏—Ä–∏–Ω—É —è–∫ –≤—ñ–¥—Å–æ—Ç–æ–∫ –≤—ñ–¥ –µ–∫—Ä–∞–Ω—É */
                                }
                                
                                .request-card {
                                    width: 100%;
                                    max-width: 1350px; /* –ó–±—ñ–ª—å—à—É—î–º–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É —à–∏—Ä–∏–Ω—É –∫–∞—Ä—Ç–æ–∫ –∑–∞–ø–∏—Ç—ñ–≤ */
                                }
                                
                                /* –°—Ç–∏–ª—ñ –¥–ª—è textarea –æ–ø–∏—Å—É —Ñ–∞–π–ª—É */
                                textarea.form-control {
                                    width: 100%;
                                    padding: 12px;
                                    border: 1px solid #E5E7EB;
                                    border-radius: 8px;
                                    font-size: 14px;
                                    transition: all 0.3s ease;
                                    resize: vertical;
                                    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
                                }
                                
                                textarea.form-control:focus {
                                    border-color: #2563EB;
                                    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2);
                                    outline: none;
                                }
                                
                                textarea.form-control::placeholder {
                                    color: #9CA3AF;
                                }
                                
                                /* –°—Ç–∏–ª—ñ –¥–ª—è —Å–∫—Ä–æ–ª–±–∞—Ä—É */
                                #files-container::-webkit-scrollbar {
                                    width: 8px;
                                    background-color: #F0F0F0;
                                }
                                
                                #files-container::-webkit-scrollbar-thumb {
                                    background-color: #C0C0C0;
                                    border-radius: 4px;
                                }
                                
                                #files-container::-webkit-scrollbar-thumb:hover {
                                    background-color: #A0A0A0;
                                }
                            </style>
                    
                    <!-- –§–æ—Ä–º–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—É -->
                            <form method="post" 
                                  enctype="multipart/form-data" 
                                  class="file-upload-form" 
                                  action="{% url 'upload_file' request_obj.id %}">
                        {% csrf_token %}
                                <div class="input-group mb-2" style="position: relative;">
                                    <input type="file" 
                                           name="file" 
                                           id="file-input-{{ request_obj.id }}" 
                                           class="form-control" 
                                           required 
                                           style="display: none;"
                                           onchange="updateFileName(this)">
                                    <label for="file-input-{{ request_obj.id }}" style="display: inline-block; background-color: #2563EB; color: white; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-right: 10px;">
                                        –í–∏–±—Ä–∞—Ç–∏ —Ñ–∞–π–ª
                                    </label>
                                    <span id="file-name-{{ request_obj.id }}" style="line-height: 40px; color: #6B7280;">–§–∞–π–ª –Ω–µ –≤–∏–±—Ä–∞–Ω–æ</span>
                                </div>
                                <div class="input-group mb-2">
                                    <label for="file-description-{{ request_obj.id }}" style="display: block; margin-bottom: 6px; color: #4B5563; font-size: 14px; font-weight: 500;">–û–ø–∏—Å —Ñ–∞–π–ª—É (–Ω–µ–æ–±–æ–≤'—è–∑–∫–æ–≤–æ):</label>
                                    <textarea id="file-description-{{ request_obj.id }}" name="description" class="form-control" placeholder="–í–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–æ—Ç–∫–∏–π –æ–ø–∏—Å —Ñ–∞–π–ª—É..." rows="2"></textarea>
                                </div>
                                <button type="submit" style="background-color: #22C55E; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                                <i class="fas fa-upload"></i> –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏
                            </button>
                    </form>
                            
                            <script>
                                function updateFileName(input) {
                                    var fileName = input.files[0] ? input.files[0].name : '–§–∞–π–ª –Ω–µ –≤–∏–±—Ä–∞–Ω–æ';
                                    var fileNameSpan = document.getElementById('file-name-' + input.id.split('-').pop());
                                    if (fileNameSpan) {
                                        fileNameSpan.textContent = fileName;
                                        fileNameSpan.style.color = input.files[0] ? '#000000' : '#6B7280';
                                    }
                                }

                                // –û–±—Ä–æ–±–∫–∞ —Ñ–æ—Ä–º–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—É
                                document.querySelector('.file-upload-form').addEventListener('submit', function(e) {
                                    e.preventDefault();
                                    var formData = new FormData(this);
                                    var requestId = this.querySelector('input[type="file"]').id.split('-').pop();

                                    fetch(this.action, {
                                        method: 'POST',
                                        body: formData,
                                        headers: {
                                            'X-Requested-With': 'XMLHttpRequest'
                                        }
                                    })
                                    .then(response => response.json())
                                    .then(data => {
                                        if (data.status === 'success') {
                                            // –û—á–∏—â–∞—î–º–æ —Ñ–æ—Ä–º—É
                                            this.reset();
                                            var fileNameSpan = document.getElementById('file-name-' + requestId);
                                            if (fileNameSpan) {
                                                fileNameSpan.textContent = '–§–∞–π–ª –Ω–µ –≤–∏–±—Ä–∞–Ω–æ';
                                                fileNameSpan.style.color = '#6B7280';
                                            }
                                            // –û–Ω–æ–≤–ª—é—î–º–æ —Å—Ç–æ—Ä—ñ–Ω–∫—É
                                            location.reload();
                                        } else {
                                            alert('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Ñ–∞–π–ª—É: ' + data.message);
                                        }
                                    })
                                    .catch(error => {
                                        console.error('Error:', error);
                                        alert('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Ñ–∞–π–ª—É');
                                    });
                                });
                            </script>
                        {% endwith %}
                </div>
            </div>
        {% endfor %}
    {% else %}
        <p>–£ –≤–∞—Å –Ω–µ–º–∞—î –∞–∫—Ç–∏–≤–Ω–∏—Ö —Ä–æ–±—ñ—Ç.</p>
    {% endif %}
    {% elif user.role == "–í–∏–∫–ª–∞–¥–∞—á" %}
    {% csrf_token %}
    <div class="messages"></div>
    {% if active_requests %}
        <h2> üìù –ê–∫—Ç–∏–≤–Ω—ñ —Ä–æ–±–æ—Ç–∏</h2>
        {% for request in active_requests|dictsortreversed:"request_date" %}
            <div class="request-card">
                <div class="request-user">
                    {% if request.student_id.profile_picture %}
                        <img src="{{ request.student_id.profile_picture.url }}" alt="–§–æ—Ç–æ –ø—Ä–æ—Ñ—ñ–ª—é" class="request-avatar">
                    {% else %}
                        <img src="{% static 'images/default-avatar.jpg' %}" alt="–§–æ—Ç–æ –ø—Ä–æ—Ñ—ñ–ª—é" class="request-avatar">
                    {% endif %}
                    <div class="user-info">
                        <a href="{% url 'profile_detail' request.student_id.id %}" class="profile-link">
                            {{ request.student_id.get_full_name }}
                        </a>
                        <p class="role">{{ request.student_id.role }}</p>
                        <p>–ì—Ä—É–ø–∞: {{ request.student_id.academic_group }}</p>
                        {% if request.teacher_theme %}
                            <strong>–¢–µ–º–∞:</strong>
                            <p class="theme">{{ request.teacher_theme.theme }}</p>
                        {% endif %}
                        {% if request.student_themes.all %}
                            <strong>–¢–µ–º–∞—Ç–∏–∫–∞ —Å—Ç—É–¥–µ–Ω—Ç–∞:</strong>
                            <ul style="list-style-type: none">
                                {% for theme in request.student_themes.all %}
                                    <li>{{ theme.theme }}</li>
                                {% endfor %}
                            </ul>
                        {% endif %}
                        <strong>–ú–æ—Ç–∏–≤–∞—Ü—ñ—è:</strong>
                        <p class="motivation">{{ request.motivation_text }}</p>
                    </div>
                </div>

                <!-- –°–µ–∫—Ü—ñ—è —Ñ–∞–π–ª—ñ–≤ -->
                <div class="files-section mt-4">
                        <h4 class="d-flex align-items-center">
                            <span class="paperclip-icon">üìé</span> –§–∞–π–ª–∏
                        </h4>
                    {% with files=active_request_files|get_item:request.id %}
                            <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ñ–∞–π–ª—ñ–≤ –∑ –ø—Ä–æ–∫—Ä—É—Ç–∫–æ—é -->
                            <div id="files-container" style="background-color: #F2F4F7; border-radius: 10px; margin-bottom: 15px; max-height: 300px; overflow-y: auto; padding: 10px; scrollbar-width: thin; scrollbar-color: #C0C0C0 #F0F0F0;">
                                {% for file in files %}
                                    <div class="file-block" style="margin-bottom: 15px; background-color: white; border-radius: 6px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
                                        <div class="file-header" style="display: flex; justify-content: space-between; align-items: center; background-color: #E6F0FF; padding: 12px; border-radius: 6px 6px 0 0; margin-bottom: 0; position: relative;">
                                            <span style="flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">{{ file.get_filename }}</span>
                                            <div style="display: flex; gap: 10px;">
                                                <a href="{% url 'download_file' file.pk %}" class="download-button" style="color: #3B82F6; background-color: #EFF6FF; border-radius: 4px; padding: 4px 8px; display: flex; align-items: center; text-decoration: none;">
                                                    <i class="fas fa-download" style="margin-right: 4px;"></i>
                                                    <span>–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏</span>
                                                </a>
                                                {% if user == file.uploaded_by %}
                                                    <button class="delete-file" 
                                                            style="background-color: #FEE2E2; border: none; color: #EF4444; cursor: pointer; border-radius: 4px; padding: 4px 8px; display: flex; align-items: center;"
                                                            data-file-id="{{ file.pk }}"
                                                            data-url="{% url 'delete_file' file.pk %}">
                                                        <i class="fas fa-trash" style="margin-right: 4px;"></i>
                                                        <span>–í–∏–¥–∞–ª–∏—Ç–∏</span>
                                                    </button>
                                                {% endif %}
                                            </div>
                                        </div>
                                        
                                        <!-- –°–µ–∫—Ü—ñ—è –æ–ø–∏—Å—É —Ñ–∞–π–ª—É -->
                                        {% if file.description %}
                                        <div class="file-description" style="background-color: #E6F0FF; padding: 15px; border-radius: 0 0 6px 6px; margin-top: 1px;">
                                            <p style="margin: 0; font-size: 14px;">
                                                <strong>–û–ø–∏—Å:</strong><br>
                                                {{ file.description }}
                                            </p>
                                        </div>
                                        {% else %}
                                        <div style="height: 1px; background-color: #E6F0FF; border-radius: 0 0 6px 6px;"></div>
                                        {% endif %}

                                        <!-- –°–µ–∫—Ü—ñ—è –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤ -->
                                        <div class="file-comments" style="padding: 15px; background-color: white; border-radius: 0 0 6px 6px; border-top: 1px solid #E5E7EB;">
                                            <h6 style="margin-bottom: 10px; color: #2563EB;">–ö–æ–º–µ–Ω—Ç–∞—Ä—ñ:</h6>
                                            
                                            <!-- –§–æ—Ä–º–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∫–æ–º–µ–Ω—Ç–∞—Ä—è -->
                                            <form method="post" action="/catalog/file/{{ file.pk }}/comment/" class="mb-3" enctype="multipart/form-data">
                                                {% csrf_token %}
                                                <div class="form-group">
                                                    <textarea name="text" class="form-control" rows="2" placeholder="–î–æ–¥–∞–π—Ç–µ –∫–æ–º–µ–Ω—Ç–∞—Ä..." style="width: 100%; padding: 8px; border: 1px solid #E5E7EB; border-radius: 6px; margin-bottom: 8px;"></textarea>
                                                    {% if user.role == "–í–∏–∫–ª–∞–¥–∞—á" %}
                                                    <div class="file-attachment-wrapper">
                                                        <div class="custom-file" style="margin-bottom: 8px;">
                                                            <input type="file" 
                                                                   name="attachment" 
                                                                   class="custom-file-input" 
                                                                   id="comment-file-{{ file.pk }}" 
                                                                   style="display: none;"
                                                                   onchange="updateCommentFile(this)">
                                                            <label for="comment-file-{{ file.pk }}" style="display: inline-block; background-color: #F8FAFC; color: #6B7280; padding: 6px 14px; border-radius: 5px; cursor: pointer; font-size: 14px; margin-right: 10px;">
                                                                <i class="fas fa-paperclip"></i> –í–∏–±—Ä–∞—Ç–∏ —Ñ–∞–π–ª
                                                            </label>
                                                            <span id="file-label-{{ file.pk }}" style="line-height: 36px; color: #6B7280;">–§–∞–π–ª –Ω–µ –≤–∏–±—Ä–∞–Ω–æ</span>
                                                        </div>
                                                        <div id="attachment-feedback-{{ file.pk }}" style="font-size: 13px; margin-top: 3px; margin-bottom: 8px; display: none;">
                                                            <span class="attachment-message" style="color: #16A34A; display: flex; align-items: center;">
                                                                <i class="fas fa-check-circle" style="margin-right: 5px;"></i> 
                                                                <span>–§–∞–π–ª –¥–æ–¥–∞–Ω–æ —ñ –±—É–¥–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ –ø—Ä–∏ –≤—ñ–¥–ø—Ä–∞–≤—Ü—ñ –∫–æ–º–µ–Ω—Ç–∞—Ä—è</span>
                                                            </span>
                                                        </div>
                                                    </div>
                                                    {% endif %}
                                                </div>
                                                <button type="submit" style="background-color: #2563EB; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">
                                                    –î–æ–¥–∞—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä
                                                </button>
                                                <div class="comment-status" style="margin-top: 10px; display: none;">
                                                    <div class="sending-status" style="color: #2563EB; display: flex; align-items: center;">
                                                        <i class="fas fa-spinner fa-spin" style="margin-right: 5px;"></i>
                                                        <span>–í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –∫–æ–º–µ–Ω—Ç–∞—Ä...</span>
                                                    </div>
                                                    <div class="success-status" style="color: #16A34A; display: none; align-items: center;">
                                                        <i class="fas fa-check-circle" style="margin-right: 5px;"></i>
                                                        <span>–ö–æ–º–µ–Ω—Ç–∞—Ä —É—Å–ø—ñ—à–Ω–æ –¥–æ–¥–∞–Ω–æ</span>
                                                    </div>
                                                </div>
                                            </form>

                                            <!-- –°–ø–∏—Å–æ–∫ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤ -->
                                            <div class="comments-list">
                                                {% for comment in file.comments.all %}
                                                    <div class="comment" style="background-color: {% if comment.author.role == '–í–∏–∫–ª–∞–¥–∞—á' %}#E6F0FF{% else %}#F3F4F6{% endif %}; padding: 10px; border-radius: 6px; margin-bottom: 8px;">
                                                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                                            <span style="font-weight: 500; color: #2563EB;">{{ comment.author.get_full_name }}</span>
                                                            <span style="color: #6B7280; font-size: 12px;">{{ comment.created_at|date:"d.m.Y H:i" }}</span>
                                                        </div>
                                                        <p style="margin: 0; font-size: 14px;">{{ comment.text }}</p>
                                                        {% if comment.attachment %}
                                                        <div class="attachment" style="margin-top: 8px; padding: 8px; background-color: rgba(255,255,255,0.6); border-radius: 4px;">
                                                            <a href="{{ comment.attachment.url }}" download style="display: flex; align-items: center; color: #2563EB; text-decoration: none;">
                                                                <i class="fas fa-paperclip" style="margin-right: 5px;"></i>
                                                                <span style="font-size: 14px; overflow: hidden; text-overflow: ellipsis;">{{ comment.get_attachment_filename }}</span>
                                                            </a>
                                                        </div>
                                                        {% endif %}
                                                        {% if user == comment.author %}
                                                            <button class="delete-comment" 
                                                                    style="background: none; border: none; color: #EF4444; font-size: 12px; padding: 0; margin-top: 5px; cursor: pointer;"
                                                                    data-comment-id="{{ comment.id }}">
                                                                –í–∏–¥–∞–ª–∏—Ç–∏
                                                            </button>
                                                        {% endif %}
                                                    </div>
                                                {% endfor %}
                                            </div>
                                        </div>
                                    </div>
                                {% empty %}
                                    <p class="text-muted" style="text-align: center; padding: 10px;">–ù–µ–º–∞—î –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤</p>
                                {% endfor %}
                            </div>

                            <!-- –§–æ—Ä–º–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—É –¥–ª—è –≤–∏–∫–ª–∞–¥–∞—á–∞ -->
                            <form method="post" 
                                  enctype="multipart/form-data" 
                                  class="file-upload-form"
                                  action="{% url 'upload_file' request.id %}">
                        {% csrf_token %}
                                <div class="input-group mb-2" style="position: relative;">
                                    <input type="file" 
                                           name="file" 
                                           id="file-input-{{ request.id }}" 
                                           class="form-control" 
                                           required 
                                           style="display: none;"
                                           onchange="updateFileName(this)">
                                    <label for="file-input-{{ request.id }}" style="display: inline-block; background-color: #2563EB; color: white; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-right: 10px;">
                                        –í–∏–±—Ä–∞—Ç–∏ —Ñ–∞–π–ª
                                    </label>
                                    <span id="file-name-{{ request.id }}" style="line-height: 40px; color: #6B7280;">–§–∞–π–ª –Ω–µ –≤–∏–±—Ä–∞–Ω–æ</span>
                                </div>
                                <div class="input-group mb-2">
                                    <label for="file-description-{{ request.id }}" style="display: block; margin-bottom: 6px; color: #4B5563; font-size: 14px; font-weight: 500;">–û–ø–∏—Å —Ñ–∞–π–ª—É (–Ω–µ–æ–±–æ–≤'—è–∑–∫–æ–≤–æ):</label>
                                    <textarea id="file-description-{{ request.id }}" name="description" class="form-control" placeholder="–í–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–æ—Ç–∫–∏–π –æ–ø–∏—Å —Ñ–∞–π–ª—É..." rows="2"></textarea>
                                </div>
                                <button type="submit" style="background-color: #22C55E; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                                <i class="fas fa-upload"></i> –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏
                            </button>
                    </form>
                        {% endwith %}
                </div>

                <!-- Complete button -->
                <div class="complete-section">
                    <div class="section-header" style="margin-bottom: 15px; display: flex; align-items: center; justify-content: flex-end;">
                    </div>
                    <p style="margin-bottom: 15px; color: #4B5563; font-size: 14px;">–ü—ñ—Å–ª—è –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è –Ω–∞ –∫–Ω–æ–ø–∫—É "–ó–∞–≤–µ—Ä—à–∏—Ç–∏ —Ä–æ–±–æ—Ç—É" –≤–∏ –∑–º–æ–∂–µ—Ç–µ –≤–∏—Å—Ç–∞–≤–∏—Ç–∏ —Ñ—ñ–Ω–∞–ª—å–Ω—É –æ—Ü—ñ–Ω–∫—É —Ç–∞ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ —Ä–æ–±–æ—Ç—É –¥–æ –∞—Ä—Ö—ñ–≤—É.</p>
                    <button onclick="showCompleteModal('{{ request.id }}')" class="complete-button">
                        <i class="fas fa-check-circle" style="margin-right: 8px; font-size: 18px;"></i> –ó–∞–≤–µ—Ä—à–∏—Ç–∏ —Ä–æ–±–æ—Ç—É
                    </button>
                </div>
            </div>
        {% endfor %}
    {% else %}
        <p>–£ –≤–∞—Å –Ω–µ–º–∞—î –∞–∫—Ç–∏–≤–Ω–∏—Ö —Ä–æ–±—ñ—Ç.</p>
    {% endif %}
{% endif %}
{% endblock %}
</div>

<!-- –î–æ–¥–∞—î–º–æ –ø—Ä–∏—Ö–æ–≤–∞–Ω–∏–π iframe -->
<iframe name="hidden_upload_frame" id="hidden_upload_frame" style="display:none;"></iframe>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
// –ì–ª–æ–±–∞–ª—å–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –Ω–∞–∑–≤–∏ —Ñ–∞–π–ª—É –¥–ª—è –∫–æ–º–µ–Ω—Ç–∞—Ä—è
function updateCommentFile(input) {
    console.log('File selection changed:', input.id);
    // –û—Ç—Ä–∏–º—É—î–º–æ ID —Ñ–∞–π–ª—É –∑ ID –ø–æ–ª—è –≤–≤–æ–¥—É
    var fileId = input.id.replace('comment-file-', '');
    console.log('File ID:', fileId);
    
    // –ó–Ω–∞—Ö–æ–¥–∏–º–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–π –µ–ª–µ–º–µ–Ω—Ç –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —ñ–º–µ–Ω—ñ —Ñ–∞–π–ª—É
    var fileLabel = document.getElementById('file-label-' + fileId);
    // –ó–Ω–∞—Ö–æ–¥–∏–º–æ –µ–ª–µ–º–µ–Ω—Ç –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —É—Å–ø—ñ—à–Ω–µ –¥–æ–¥–∞–≤–∞–Ω–Ω—è
    var feedback = document.getElementById('attachment-feedback-' + fileId);
    
    console.log('File label element:', fileLabel);
    console.log('Feedback element:', feedback);
    console.log('Has files:', input.files.length > 0);
    
    // –û–Ω–æ–≤–ª—é—î–º–æ —Ç–µ–∫—Å—Ç —Ç–∞ —Å—Ç–∏–ª—ñ
    if (input.files.length > 0) {
        console.log('Selected file name:', input.files[0].name);
        fileLabel.textContent = input.files[0].name;
        fileLabel.style.color = '#000000';
        if (feedback) {
            feedback.style.display = 'block';
        }
    } else {
        fileLabel.textContent = '–§–∞–π–ª –Ω–µ –≤–∏–±—Ä–∞–Ω–æ';
        fileLabel.style.color = '#6B7280';
        if (feedback) {
            feedback.style.display = 'none';
        }
    }
}

$(document).ready(function() {
    // –î–æ–¥–∞—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫ –Ω–∞ –≤—Å—ñ –∫–Ω–æ–ø–∫–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—è
    $(document).on('click', '.delete-file', function(e) {
        e.preventDefault();
        var button = $(this);
        var url = button.data('url');
        
        // –°—Ç–≤–æ—Ä—é—î–º–æ –≤–ª–∞—Å–Ω–µ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ
        var modal = $(`
            <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 9999; display: flex; align-items: flex-start; justify-content: center; padding-top: 5%;">
                <div style="background: white; border-radius: 0.75rem; border: 2px solid #6FCF97; padding: 1.25rem; position: relative; width: 400px; max-width: 90%;">
                    <button type="button" style="position: absolute; right: 15px; top: 15px; background: none; border: none; font-size: 24px; cursor: pointer; color: #333;">√ó</button>
                    <div style="display: flex; align-items: center; margin-bottom: 1rem;">
                        <div style="width: 44px; height: 44px; margin-right: 15px;">
                            <svg viewBox="0 0 44 44" style="width: 100%; height: 100%;">
                                <circle cx="22" cy="22" r="22" fill="#6FCF97"/>
                                <path d="M18 24.5L14 20.5L12 22.5L18 28.5L32 14.5L30 12.5L18 24.5Z" fill="white"/>
                            </svg>
                        </div>
                        <h3 style="margin: 0; font-size: 1.25rem;">–ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è</h3>
                    </div>
                    <p style="margin-bottom: 1.5rem;">–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π —Ñ–∞–π–ª?</p>
                    <div style="display: flex; justify-content: flex-end; gap: 10px;">
                        <button type="button" class="cancel-button" style="padding: 8px 16px; background: #FF4444; color: white; border: none; border-radius: 5px; cursor: pointer;">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                        <button type="button" class="confirm-button" style="padding: 8px 16px; background: #6FCF97; color: white; border: none; border-radius: 5px; cursor: pointer;">OK</button>
                    </div>
                </div>
            </div>
        `);
        
        // –î–æ–¥–∞—î–º–æ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–æ body
        $('body').append(modal);
        
        // –û–±—Ä–æ–±–Ω–∏–∫ –∑–∞–∫—Ä–∏—Ç—Ç—è –ø–æ –∫–Ω–æ–ø—Ü—ñ X
        modal.find('button:first').click(function() {
            modal.remove();
        });
        
        // –û–±—Ä–æ–±–Ω–∏–∫ –∫–Ω–æ–ø–∫–∏ "–°–∫–∞—Å—É–≤–∞—Ç–∏"
        modal.find('.cancel-button').click(function() {
            modal.remove();
        });
        
        // –û–±—Ä–æ–±–Ω–∏–∫ –∫–Ω–æ–ø–∫–∏ "OK"
        modal.find('.confirm-button').click(function() {
            $.ajax({
                url: url,
                type: 'POST',
                headers: {
                    'X-CSRFToken': $('[name=csrfmiddlewaretoken]').val()
                },
                success: function(response) {
                    if (response.success) {
                        window.location.reload();
                    } else {
                        alert('–ü–æ–º–∏–ª–∫–∞: ' + (response.error || '–ù–µ –≤–¥–∞–ª–æ—Å—è –≤–∏–¥–∞–ª–∏—Ç–∏ —Ñ–∞–π–ª'));
                    }
                },
                error: function(xhr, status, error) {
                    console.error('Error:', xhr.responseText);
                    alert('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ —Ñ–∞–π–ª—É');
                }
            });
            modal.remove();
        });
        
        // –ó–∞–∫—Ä–∏—Ç—Ç—è –ø–æ –∫–ª—ñ–∫—É –Ω–∞ —Ñ–æ–Ω
        modal.click(function(e) {
            if ($(e.target).is(modal)) {
                modal.remove();
            }
        });
    });

    // –û–±—Ä–æ–±–Ω–∏–∫ –¥–ª—è —Ñ–æ—Ä–º –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤
    $('form[action^="/catalog/file/"][action$="/comment/"]').on('submit', function(e) {
        e.preventDefault();
        
        var form = $(this);
        var fileId = form.attr('action').split('/').slice(-2)[0];
        var textarea = form.find('textarea[name="text"]');
        var commentText = textarea.val().trim();
        var submitBtn = form.find('button[type="submit"]');
        var commentStatus = form.find('.comment-status');
        var sendingStatus = commentStatus.find('.sending-status');
        var successStatus = commentStatus.find('.success-status');
        var hasAttachment = form.find('input[type="file"]').prop('files').length > 0;
        
        console.log('Submitting comment for file ID:', fileId);
        
        // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å —Ç–µ–∫—Å—Ç—É –∞–±–æ —Ñ–∞–π–ª—É
        if (!commentText && !hasAttachment) {
            alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å —Ç–µ–∫—Å—Ç –∫–æ–º–µ–Ω—Ç–∞—Ä—è –∞–±–æ –ø—Ä–∏–∫—Ä—ñ–ø—ñ—Ç—å —Ñ–∞–π–ª');
            return;
        }
        
        // –ü–æ–∫–∞–∑—É—î–º–æ —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä –≤—ñ–¥–ø—Ä–∞–≤–∫–∏
        commentStatus.show();
        sendingStatus.css('display', 'flex');
        successStatus.hide();
        
        // –î–µ–∞–∫—Ç–∏–≤—É—î–º–æ –∫–Ω–æ–ø–∫—É –Ω–∞ —á–∞—Å –≤—ñ–¥–ø—Ä–∞–≤–∫–∏
        submitBtn.prop('disabled', true);
        
        // –°—Ç–≤–æ—Ä—é—î–º–æ FormData –¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–∏—Ö, –≤–∫–ª—é—á–∞—é—á–∏ —Ñ–∞–π–ª
        var formData = new FormData(form[0]);
        
        // –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –∑–∞–ø–∏—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        $.ajax({
            url: form.attr('action'),
            type: 'POST',
            data: formData,
            processData: false,
            contentType: false,
            cache: false,
            success: function(response) {
                // –ü–æ–∫–∞–∑—É—î–º–æ —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä —É—Å–ø—ñ—Ö—É
                sendingStatus.hide();
                successStatus.css('display', 'flex');
                
                // –û—á–∏—â–∞—î–º–æ —Ñ–æ—Ä–º—É
                textarea.val('');
                if (hasAttachment) {
                    form.find('input[type="file"]').val('');
                    form.find('#file-label-' + fileId).text('');
                    form.find('#attachment-feedback-' + fileId).hide();
                }
                
                // –ß–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥–∏ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Å—Ç–æ—Ä—ñ–Ω–∫—É
                setTimeout(function() {
                    location.reload();
                }, 2000);
            },
            error: function(xhr, status, error) {
                // –•–æ–≤–∞—î–º–æ —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä –≤—ñ–¥–ø—Ä–∞–≤–∫–∏
                commentStatus.hide();
                
                // –ü–æ–∫–∞–∑—É—î–º–æ –ø–æ–º–∏–ª–∫—É
                try {
                    var errorData = JSON.parse(xhr.responseText);
                    alert('–ü–æ–º–∏–ª–∫–∞: ' + (errorData.error || '–ù–µ –≤–¥–∞–ª–æ—Å—è –¥–æ–¥–∞—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä'));
                } catch (e) {
                    alert('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—ñ –∫–æ–º–µ–Ω—Ç–∞—Ä—è: ' + error);
                }
            },
            complete: function() {
                // –ê–∫—Ç–∏–≤—É—î–º–æ –∫–Ω–æ–ø–∫—É –ø—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –∑–∞–ø–∏—Ç—É
                submitBtn.prop('disabled', false);
            }
        });
    });

    // –û–±—Ä–æ–±–Ω–∏–∫ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∫–æ–º–µ–Ω—Ç–∞—Ä—è
    $(document).on('click', '.delete-comment', function() {
        var button = $(this);
        var commentId = button.data('comment-id');
        
        if (confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π –∫–æ–º–µ–Ω—Ç–∞—Ä?')) {
            $.ajax({
                url: '/catalog/comment/' + commentId + '/delete/',
                type: 'POST',
                data: {
                    'csrfmiddlewaretoken': $('[name=csrfmiddlewaretoken]').val()
                },
                success: function(response) {
                    if (response.success) {
                        button.closest('.comment').fadeOut(300, function() {
                            $(this).remove();
                        });
                    }
                },
                error: function(xhr) {
                    alert('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ –∫–æ–º–µ–Ω—Ç–∞—Ä—è');
                }
            });
        }
    });
});

// –§—É–Ω–∫—Ü—ñ—ó –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –º–æ–¥–∞–ª—å–Ω–∏–º –≤—ñ–∫–Ω–æ–º –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ä–æ–±–æ—Ç–∏
function showCompleteModal(requestId) {
    const modal = document.getElementById('completeModal');
    document.getElementById('completeRequestId').value = requestId;
    modal.style.display = "flex";
}

function closeCompleteModal() {
    document.getElementById('completeModal').style.display = "none";
}

function submitComplete() {
    const requestId = document.getElementById('completeRequestId').value;
    const grade = document.getElementById('grade').value;
    
    if (!grade || grade < 0 || grade > 100) {
        alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –æ—Ü—ñ–Ω–∫—É –≤—ñ–¥ 0 –¥–æ 100');
        return;
    }

    // –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –∑–∞–ø–∏—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä
    $.ajax({
        url: '/catalog/complete-request/' + requestId + '/',
        type: 'POST',
        headers: {
            'X-CSRFToken': $('[name=csrfmiddlewaretoken]').val()
        },
        data: {
            'grade': grade
        },
        success: function(response) {
            if (response.success) {
                window.location.reload();
            } else {
                alert('–ü–æ–º–∏–ª–∫–∞: ' + (response.error || '–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–µ—Ä—à–∏—Ç–∏ —Ä–æ–±–æ—Ç—É'));
            }
        },
        error: function(xhr, status, error) {
            console.error('Error:', xhr.responseText);
            alert('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ñ —Ä–æ–±–æ—Ç–∏');
        }
    });
    
    closeCompleteModal();
}
</script>

<!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ä–æ–±–æ—Ç–∏ -->
<div id="completeModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
    <div style="background-color: white; padding: 20px; border-radius: 8px; width: 400px; max-width: 90%;">
        <h3>–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ä–æ–±–æ—Ç–∏</h3>
        <p>–í–∫–∞–∂—ñ—Ç—å –ø—ñ–¥—Å—É–º–∫–æ–≤—É –æ—Ü—ñ–Ω–∫—É:</p>
        <input type="hidden" id="completeRequestId" value="">
        <div style="margin-bottom: 15px;">
            <input type="number" id="grade" min="0" max="100" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" placeholder="–û—Ü—ñ–Ω–∫–∞ (0-100)">
        </div>
        <div style="display: flex; justify-content: flex-end; gap: 10px;">
            <button onclick="closeCompleteModal()" style="padding: 8px 16px; background-color: #f1f1f1; border: none; border-radius: 4px; cursor: pointer;">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
            <button onclick="submitComplete()" style="padding: 8px 16px; background-color: #22C55E; color: white; border: none; border-radius: 4px; cursor: pointer;">–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏</button>
        </div>
    </div>
</div>

<style>
    .files-section {
        width: 100%;
        max-width: 1350px;
    }
    
    .file-block {
        width: 100%;
        display: flex;
        flex-direction: column;
    }
    
    .file-header {
        padding-right: 15px !important;
    }
    
    .file-header span {
        max-width: 90%;
    }
    
    .file-comments {
        width: 100%;
    }
    
    .comment-form textarea {
        width: 100%;
        min-height: 80px;
    }
    
    /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ñ —Å—Ç–∏–ª—ñ –¥–ª—è –≤–∫–ª–∞–¥–∫–∏ –∞–∫—Ç–∏–≤–Ω–∏—Ö —Ä–æ–±—ñ—Ç */
    @media (min-width: 992px) {
        .request-user {
            display: flex;
            gap: 30px;
        }
        
        .user-info {
            flex: 1;
        }
        
        .files-section {
            padding-left: 20px;
        }
    }

    .complete-button {
        background-color: #0F766E; 
        color: white; 
        border: none; 
        padding: 12px 24px; 
        border-radius: 8px; 
        font-size: 16px; 
        font-weight: 500; 
        cursor: pointer; 
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); 
        transition: all 0.3s ease; 
        display: inline-flex; 
        align-items: center;
    }

    .complete-button:hover {
        background-color: #0E6659;
        box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        transform: translateY(-2px);
    }

    .complete-button:active {
        transform: translateY(0);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    /* –°—Ç–∏–ª—ñ –¥–ª—è —Å–µ–∫—Ü—ñ—ó –∑–∞–≤–µ—Ä–µ—à–µ–Ω–Ω—è —Ä–æ–±–æ—Ç–∏ */
    .complete-section {
        padding: 0 0 15px 0;
        margin-top: 20px;
        border-top: 1px solid #E5E7EB;
        padding-top: 15px;
        text-align: right;
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: flex-end;
    }
    
    .complete-section p {
        max-width: 500px;
    }

    /* –°—Ç–∏–ª—ñ –¥–ª—è —Å–∫—Ä–æ–ª–±–∞—Ä—É */
    #files-container::-webkit-scrollbar {
        width: 8px;
        background-color: #F0F0F0;
    }
    
    #files-container::-webkit-scrollbar-thumb {
        background-color: #C0C0C0;
        border-radius: 4px;
    }
    
    #files-container::-webkit-scrollbar-thumb:hover {
        background-color: #A0A0A0;
    }

    /* –°—Ç–∏–ª—ñ –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Ñ–∞–π–ª—ñ–≤ */
    #files-container {
        background-color: #F2F4F7;
        border-radius: 10px;
        margin-bottom: 15px;
        max-height: 300px;
        overflow-y: auto;
        padding: 10px;
        scrollbar-width: thin;
        scrollbar-color: #C0C0C0 #F0F0F0;
    }

    .file-block {
        margin-bottom: 15px;
        background-color: white;
        border-radius: 6px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .file-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background-color: #E6F0FF;
        padding: 12px;
        border-radius: 6px 6px 0 0;
        margin-bottom: 0;
        position: relative;
    }

    .file-description {
        background-color: #E6F0FF;
        padding: 15px;
        border-radius: 0 0 6px 6px;
        margin-top: 1px;
    }

    .file-comments {
        padding: 15px;
        background-color: white;
        border-radius: 0 0 6px 6px;
        border-top: 1px solid #E5E7EB;
    }

    /* –°—Ç–∏–ª—ñ –¥–ª—è —Ñ–æ—Ä–º–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤ */
    .file-upload-form {
        margin-top: 15px;
        padding: 15px;
        background-color: #F8FAFC;
        border-radius: 8px;
    }

    .file-upload-form label[for^="file-input"] {
        display: inline-block;
        background-color: #2563EB;
        color: white;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        margin-right: 10px;
        transition: background-color 0.3s ease;
    }

    .file-upload-form label[for^="file-input"]:hover {
        background-color: #1D4ED8;
    }

    .file-upload-form textarea {
        width: 100%;
        padding: 12px;
        border: 1px solid #E5E7EB;
        border-radius: 8px;
        margin-bottom: 10px;
        resize: vertical;
    }

    .file-upload-form button[type="submit"] {
        background-color: #22C55E;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

    .file-upload-form button[type="submit"]:hover {
        background-color: #16A34A;
    }
</style>