{% load static %}
{% load catalog_extras %}
<section class="teacher-info">
    <div class="teacher-card">
      <div class="photo-container">
        <div class="teacher-photo">
          <img :src="item.teacher.photo || '{% static 'images/default-avatar.jpg' %}'" alt="Teacher photo">
        </div>
      </div>
      <div class="teacher-details">
        <h2>
          <a :href="(() => { const tid = item?.teacher?.teacher_id?.id || item?.teacher?.id || item?.teacher?.pk; return `/users/profile/${tid}/`; })()" x-text="`${item.teacher.teacher_id.full_name}`"></a>
        </h2>
        <template x-if="item.teacher.academic_level">
          <h3 x-text="`${item.teacher.academic_level}`"></h3>
        </template>
        <template x-if="item.teacher.academic_level === null">
          <h3>Викладач</h3>
        </template>  
        <p class="department" x-text="`Кафедра ${item.teacher.teacher_id.department || 'Не вказано'}`"></p>

        <!-- Conditional logic for displaying the number of free slots. -->
        <div class="slots-container" x-show="item.is_matched || !item.is_matched">
          <!-- No slots -->
          <div class="slots-info no-slots" x-show="item.free_slots.length < 1">
            <p><strong>Місць немає</strong></p>
          </div>

          <!-- Single slot -->
          <div class="slots-info single-slot" x-show="item.is_matched && item.free_slots.length === 1">
            <strong>Місць:</strong>
            <span x-text="item.free_slots[0].get_available_slots"></span>
          </div>

          <!-- Multiple slots -->
          <div class="slots-info multiple-slots" x-show="!item.is_matched && item.free_slots.length >= 1">
            <ul>
              <template x-for="slot in item.free_slots" :key="slot.id">
                <li>
                  <strong x-text="slot.stream_id.stream_code"></strong>:
                  <span x-text="slot.get_available_slots"></span>
                </li>
              </template>
            </ul>
          </div>
        </div>

      </div>
      
      <!-- Button on the card's right side that triggers HTMX to load the modal content. -->
      <div class="card-right-side">
        {% if user.is_authenticated and user.role == 'Студент'%}
          <template x-if="item.teacher.already_requested">
            <button class="modal-button tooltip-custom" disabled>
              <span class="arrow-icon">›</span>
              <span class="tooltiptext">Ви вже надіслали запит до цього викладача</span>
            </button>
          </template>
          <template x-if="!item.teacher.already_requested && item.has_active">
            <button class="modal-button tooltip-custom" disabled>
              <span class="arrow-icon">›</span>
              <span class="tooltiptext">У вас вже є активна робота</span>
            </button>
          </template>
          <template x-if="!item.teacher.already_requested && !item.has_active">
            <button class="modal-button"
              :data-teacher-id="item.teacher.id"
              :data-teacher-name="item.teacher.teacher_id.full_name"
              :data-teacher-url="item.teacher.url"
              @click="htmx.ajax('GET', item.teacher.url, { target: '#inner_modal' })">
              <span class="arrow-icon">›</span>
            </button>
          </template>
        {% else %}
          <button class="modal-button tooltip-custom" disabled>
            <span class="arrow-icon">›</span>
            <span class="tooltiptext">У вас немає прав для надсилання запитів</span>
          </button>
        {% endif %}
      </div>
    </div> 
  </section>