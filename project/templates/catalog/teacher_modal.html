{% load static %}

<!-- Font Awesome stylesheet for icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">

<section class="info-request-section">
    <!-- Close modal button -->
    <a class="close-modal fas fa-times"></a>
       
    <div class="left-container">
        <!-- Display teacher's photo or a default image -->
        <img src="{{photo}}" alt="Teacher">
        <!-- Display teacher's name -->
        <h2>
            {{ teacher.teacher_id.get_full_name_with_patronymic | capfirst }}
        </h2>
        <!-- Display teacher's position or a default value -->
        {% if teacher.academic_level%}
            <p class="position">{{ teacher.academic_level | capfirst }}</p>
        {% else %}
            <p class="position">Викладач</p>
        {% endif %}
        
        <!-- Display teacher's department -->
        <h3>Кафедра {{ teacher.teacher_id.get_department_name | capfirst }}</h3>

        <!-- Display slot availability -->
        {% if is_matched %}
            <div>
                <p class="single-slot"><strong>Місця:</strong> {{ free_slots.first.get_available_slots }}</p>
            </div>
            {% if free_slots.count < 1 %}
                <div class="slots-info no-slots">
                    <p><strong>Місць немає</strong></p>
                </div>
            {% endif %}
        {% else %}
            {% if free_slots.count < 1 %}
                <div class="slots-info no-slots">
                    <p><strong>Місць немає</strong></p>
                </div>
            {%else%}
                <div class="slots-info multiple-slots">
                    <p><strong>Загальна кількість місць:</strong></p>
                    <ul>
                        {% for slot in free_slots %}
                            <li><strong>{{ slot.stream_id.stream_code }}:</strong> {{ slot.get_available_slots }}</li>
                        {% endfor %}
                    </ul>
                </div>
            {%endif%}
        {% endif %}
    </div>

    <div class="right-container">
        <!-- Form for submitting a request -->
        <form data-action-url="{% url 'modal' teacher.pk %}" class="teacher-modal" id="request-form">
            <div id="form-errors" class="error-container"></div>
            <h1 style="margin-top: 0; align-self: center;">Подай заявку!</h1>
            <input type="hidden" name="csrfmiddlewaretoken" id="csrf_token" value="{{ csrf_token }}">
        
            <!-- Enhanced dropdown for selecting teacher themes -->
            <div class="dropdown">
                {{ form.teacher_themes.label_tag|cut:":" }}
                <div class="dropdown-input">
                    {{ form.teacher_themes }}
                    <!-- Enhanced dropdown chevron icon -->
                    <button type="button" id="dropdown-toggle" class="dropdown-toggle">
                        <i class="fas fa-chevron-down dropdown-icon"></i>
                    </button>
                </div>
                <div id="dropdown-menu" class="dropdown-menu">
                    <li class="dropdown-item" data-value="">
                        <span class="theme-text">-</span>
                    </li>
                    {% if form.themes_list %}
                        {% for theme_id, theme_name in form.themes_list %}
                            <li class="dropdown-item" data-value="{{ theme_name }}">
                                <span class="theme-text">{{ theme_name }}</span>
                            </li>
                        {% endfor %}
                    {% else %}
                        <div class="dropdown-item no-themes">
                            <i class="fas fa-exclamation-circle"></i>
                            <span>Вільні теми відсутні!</span>
                        </div>
                    {% endif %}
                </div>
            </div>

            <p style="text-align: center; margin: 0; color: #a3a3a3; font-style: italic; align-self: center;">та/або</p>

            <!-- Restructured theme addition section to use existing CSS classes -->
            <div class="add-theme-container">
                {{ form.student_themes.label_tag|cut:":" }}
                
                <div class="input-add">
                    {{ form.student_themes }}
                    <button type="button" id="add-theme" class="add-theme" title="Додати тему">
                        +
                    </button>
                </div>
                
                <!-- Added theme counter with existing styling -->
                <div style="text-align: right; margin-bottom: 0.5rem;">
                    <small style="color: #a3a3a3; font-size: 0.75rem;">
                        <span id="theme-count">0</span>/3 тем
                    </small>
                </div>
                
                <!-- Hidden inputs container -->
                <div id="hidden-themes"></div>
                
                <!-- Made themes container scrollable with fixed height -->
                <div id="themes-container" style="max-height: 200px; overflow-y: auto; border-radius: 8px; margin-top: 0.5rem;">
                    <!-- Theme list using existing CSS classes -->
                    <ul id="theme-list" class="theme-list" style="display: none; margin: 0; padding: 8px;"></ul>
                    
                    <!-- Placeholder with existing styling -->
                    <div id="theme-placeholder" style="text-align: center; padding: 0.75rem; color: #a3a3a3; border: 2px dashed #e0e0e0; border-radius: 0.5rem;">
                        <i class="fas fa-lightbulb" style="font-size: 1.25rem; margin-bottom: 0.25rem; display: block;"></i>
                        <p style="margin: 0.25rem 0 0.125rem 0; font-weight: 500; font-size: 0.875rem;">Додайте свої власні теми для дослідження</p>
                        <small style="font-size: 0.6875rem;">Ви можете додати до 3 тем</small>
                    </div>
                </div>
            </div>
        
            <!-- Motivation text input -->
            <div class="textera-container">
                {{ form.motivation_text }}
            </div>   
        
            <!-- Submit button -->
            <button type='submit' class="submit-btn" id="submit-btn" {% if not free_slots %}disabled{% endif %}>
                Надіслати
            </button>
        </form>
    </div>
</section>
<script src="{% static 'js/teacher_modal.js'%}" defer></script>